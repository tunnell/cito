#!/usr/bin/env python
"""Start event builder and trigger software for continuous processing..

Process data through the event builder and software trigger. The default
behavior of this command is to take data from the input database, process
it, then write events out to the output database.  (This command does not
build files.)
"""
# __author__ = 'tunnell'

import logging
import time

from configglue import schema
from configglue.glue import configglue

from wax import Configuration
from wax.EventBuilder.Processor import ProcessTask


def main(config):
    log = logging.getLogger('EventBuilder')

    # do something
    values = config.values('__main__')

    p = ProcessTask(chunk_size=values.get('chunksize'),
                    padding=values.get('padding'))

    if values.get('dataset') == None:
        p.loop_and_find_new_datasets(values.get('hostname'))
    else:
        p.process_single_dataset(hostname=values.get('hostname'),
                                 dataset=values.get('dataset'))


if __name__ == '__main__':
    class eb(schema.Schema, Configuration.EventBuilder, Configuration.Mongo):
        pass

    glue = configglue(eb, ['config.ini'])

    main(glue.schema_parser)